/*! auth - v1.5 - 2013-08-07 3:16:53 PM
* Copyright (c) 2013 ��ͦ; Licensed  */
KISSY.add("gallery/auth/1.5/lib/rule/base",function(a,b){var c="success",d="error",e={success:"",error:""},f=function(){var b=[].slice.call(arguments),c=this;c.validation=b[0]?b[0]:function(){return!0};var d=a.merge({},b[1]);b[1]&&(c._args=a.isArray(d.args)?d.args:[d.args]),a.isPlainObject(d.msg)||(d.msg={error:d.msg}),c._msg=a.merge(e,d.msg),f.superclass.constructor.call(c)};return a.extend(f,b,{validate:function(){var a=this;a.fire("beforeValidate");var b=[].slice.call(arguments);b=a._setArgs(b);var e,f=a.validation.apply(a,b);return e=a._msg?f?a._msg[c]:a._msg[d]:f?a._msg[c]:"",a.fire(f?c:d,{msg:e}),a.fire("validate",{result:f,msg:e,name:a._name}),a.fire("afterValidate"),f},_setArgs:function(b){var c=this;b=b.length?b:c._args,b=a.filter(b,function(b){return!a.isUndefined(b)});var d=c.get("field");return""!=d&&b.push(d),b}},{ATTRS:{msg:{value:"",setter:function(b){this._msg=a.merge(this._msg,b)}},field:{value:""}}}),f},{requires:["base"]}),KISSY.add("gallery/auth/1.5/lib/utils",function(S,DOM,undefined){var Utils={toJSON:function(cfg){cfg=cfg.replace(/'/g,'"');try{eval("cfg="+cfg)}catch(e){S.log("data-valid json is invalid")}return cfg},guid:function(){return"AUTH_"+S.guid()},getEvent:function(a){var b="blur",c=DOM.attr(a,"type");switch(c){case"select-multiple":case"radio":case"checkbox":b="click";break;default:b="blur"}return b},getValue:function(a){var b=[],c=DOM.attr(a,"type");switch(c){case"select-multiple":S.each(a.options,function(a){a.selected&&b.push(a.value)});break;case"radio":case"checkbox":S.each(a,function(a){a.checked&&b.push(a.value)});break;default:b=DOM.val(a)}return b}};return Utils},{requires:["dom"]}),KISSY.add("gallery/auth/1.5/lib/rule/html/propertyRule",function(a,b,c){var d=function(){var b=this,c=[].slice.call(arguments);if(!c.length)return a.log("please use a name to define property"),void 0;b._name=c[0];var e=c[2]||{args:[]};b._initArgs=e.args,b._propertyValue=e.propertyValue,b._el=e.el,d.superclass.constructor.apply(b,c.slice(1))};return a.extend(d,b,{validate:function(){var b=this;if(a.isUndefined(arguments[0]))return d.superclass.validate.apply(this,[b._propertyValue,c.getValue(b._el)].concat(b._initArgs));var e=[].slice.call(arguments);return b._initArgs=e,d.superclass.validate.apply(this,[b._propertyValue,c.getValue(b._el)].concat(e))}}),d},{requires:["../base","../../utils"]}),KISSY.add("gallery/auth/1.5/lib/rule/rule",function(a,b,c){var d=function(){var b=this,c=[].slice.call(arguments);if(!c.length)return a.log("please use a name to define rule"),void 0;b._name=c[0];var e=c[2]||{args:[]};b._initArgs=e.args,b._el=e.el,d.superclass.constructor.apply(b,c.slice(1))};return a.extend(d,b,{validate:function(){var b=this;if(a.isUndefined(arguments[0]))return d.superclass.validate.apply(this,[c.getValue(b._el)].concat(b._initArgs));var e=[].slice.call(arguments);return b._initArgs=e,d.superclass.validate.apply(this,[c.getValue(b._el)].concat(e))}}),d},{requires:["./base","../utils"]}),KISSY.add("gallery/auth/1.5/lib/rule/ruleFactory",function(a,b,c,d,e,f){b.all;var g=function(){var a=this;g.superclass.constructor.call(a)};return g.rules={},a.mix(g.rules,{required:function(b,c,d){var e=d.get("uploader");return e?e.testRequired():a.isArray(c)?c.length>0:!!c},pattern:function(a,b){return new RegExp(a).test(b)},max:function(b,c,d){var e=d.get("uploader");return e?e.testMax():a.isNumber(c)?b>=c:!1},min:function(b,c){return a.isNumber(c)?c>=b:!1},step:function(b,c){return a.isNumber(c)?0==c||1==b?!0:c%b:!1},equalTo:function(b,c){return a.isNumber(c)?b===c:a.one(b)?a.one(b).val()===c:b===c}}),a.mix(g,{HTML_PROPERTY:["required","pattern","max","min","step","equalTo"],register:function(a,b){g.rules[a]=b},create:function(b,c){return c.msg||(c.msg={}),a.inArray(b,g.HTML_PROPERTY)?new d(b,g.rules[b],c):g.rules[b]?new e(b,g.rules[b],c):f}}),g},{requires:["node","base","./html/propertyRule","./rule"]}),KISSY.add("gallery/auth/1.5/lib/msg/base",function(a,b,c,d){function e(b,c){var d=this;c||(c={}),b&&a.mix(c,{target:b}),e.superclass.constructor.call(d,c),d._init()}var f=c.all,g=".J_AuthMsg";return a.extend(e,b,{_init:function(){var a=this,b=a.get("target");return b.length?(a.set("wrapper",a._getWrapper()),void 0):!1},hide:function(){var b=this,c=b.get("wrapper");a.buffer(function(){c.hide()},50)()},show:function(b){var c=this;c.get("args");var e=c.get("tpl"),f=c.get("wrapper");a.buffer(function(){if(!f.children(".auth-msg").length||b.reCreate){var a=new d(e).render(b);f.html(a)}f.show()},50)()},_getWrapper:function(){var a=this,b=a.get("wrapper"),c=a.get("target");if(!c.length)return a;var d=c.attr("msg-wrapper");return d&&(b=f(d)),b&&b.length||(b=c.parent().all(g)),b}},{ATTRS:{target:{value:"",getter:function(a){return f(a)}},tpl:{value:'<p class="auth-msg {{style}}">{{msg}}</p>'},args:{value:{}},wrapper:{value:"",getter:function(a){return f(a)}}}}),e},{requires:["base","node","xtemplate"]}),KISSY.add("gallery/auth/1.5/lib/field/field",function(a,b,c,d,e,f,g,h,i,j){var k="",l="data-valid",m={event:"blur",style:{success:"ok",error:"error"}},n=function(b,c){var d=this;if(d._validateDone={},d._cache={},b&&e.attr(b,l)){var f=e.attr(b,l);f=j.toJSON(f);var g={rules:f};c=a.merge(g,c)}return c=a.merge(m,c),d._cfg=c||{},d._storage={},d._init(b),n.superclass.constructor.call(d,c),d};return a.extend(n,c,{_init:function(c){var d=this,e=d._cfg,g=a.one(c),h=a.merge({},e.rules);if(a.inArray(g.attr("type"),["checkbox","radio"])){var l=g.getDOMNode().form,m=g.attr("name"),n=[];a.each(document.getElementsByName(m),function(a){a.form==l&&n.push(a)}),d.set("el",n)}else d.set("el",c);var o=function(){d.fire("afterFieldValidation")};d._msg=new i(g,d._cfg.msg),d.set("oMsg",d._msg);var p=d._cfg.style;d.on("afterRulesValidate",function(a){var b=a.result,c=a.curRule,e=d._cache[c].msg||k;(d.get("result")!==b||d.get("msg")!==e)&&(e?d._msg.show({style:b?p.success:p.error,msg:e}):d._msg.hide())}),d.on("afterRulesValidate",function(a){var b=a.result,c=a.curRule,e=d._cache[c].msg||k;d.set("result",b),d.set("message",e),d.fire("validate",{result:b,msg:e,errRule:b?"":c}),d.fire("afterValidate"),o()});var q=g.attr("type");"image-uploader"!=q&&"file"!=q&&a.each(f.HTML_PROPERTY,function(a){if(g.hasAttr(a)){var b=f.create(a,{propertyValue:g.attr(a),el:d.get("el"),msg:h[a]});d.add(a,b)}}),a.each(h,function(b,c){if(!d._storage[c]&&f.rules[c]){var e={el:d.get("el"),msg:b};b.propertyValue&&a.mix(e,{args:[b.propertyValue]});var g=f.create(c,e);d.add(c,g)}}),"none"!=e.event&&b.on(d.get("el"),e.event||j.getEvent(g),function(){a.later(function(){d.validate()})})},add:function(b,c){var d=this,e=d._storage;return c instanceof h||c instanceof g?e[b]=c:a.isFunction(c)&&(e[b]=new g(b,c,{el:d._el})),d.set("oRules",e),e[b]&&e[b].on("validate",function(b){a.log("[after rule validate]: name:"+b.name+",result:"+b.result+",msg:"+b.msg),d._cache[b.name].result=b.result,d._cache[b.name].msg=b.msg}),this._cache[b]={},d},remove:function(a){var b=this._storage;return delete b[a],delete this._cache[a],self.set("oRules",b),this},validate:function(a,b){var c=!0,d=this,b=b||{},e=k,f=d.get("oRules");if(d.fire("beforeValidate"),a)f[a]&&(c=f[a].validate(b.args),e=a);else{var g;for(var h in f){e=h;var i=f[h];if(i.set("field",d),g=i.validate(b.args),!g){c=!1;break}}}return e&&d.fire("afterRulesValidate",{result:c,curRule:e}),c}},{ATTRS:{message:{value:k},result:{},el:{},oRules:{value:{}},oMsg:{value:""}}}),n},{requires:["event","base","json","dom","../rule/ruleFactory","../rule/rule","../rule/html/propertyRule","../msg/base","../utils"]}),KISSY.add("gallery/auth/1.5/lib/base",function(a,b,c,d,e,f){var g={autoBind:!0,stopOnError:!1},h={FORM:"form",OBJECT:"object"},i=function(b,c){var d=a.get(b),e=this;return e._storages={},c=a.merge(g,c),e.AuthConfig=c,d&&(e.mode=h.FORM,e._init(d,c)),i.superclass.constructor.call(e),e};return a.extend(i,c,{_init:function(b,c){var e=b.elements,g=this;e&&e.length&&a.each(e,function(b){var e=a.merge(c,{event:c.autoBind?f.getEvent(b):"none"}),h=new d(b,e);h.addTarget(g),h.publish("validate",{bubble:1}),g.add(h)}),g.AuthConfig=c,g.mode===h.FORM&&a.one(b).attr("novalidate","novalidate")},add:function(b,c){var e,g,h=this,i="";if(b instanceof d)e=b.get("el"),g=h.getName(e),i=h._storages[g||f.guid()]=b;else{if(e=a.one(b),!e.length)return!1;g=h.getName(e);var j=h.mergeConfig(e,c);i=h._storages[g]=new d(e,j)}return i},mergeConfig:function(b,c){if(!b||!b.length)return!1;var d=this,e=a.merge(d.AuthConfig,{event:d.AuthConfig.autoBind?f.getEvent(b):"none"},c),g=d.getFieldAttrRules(b);return a.isEmptyObject(g)||(e.rules=a.merge(g,e.rules)),e},getName:function(a){return a&&a.length?a.attr("id")||a.attr("name")||f.guid():""},getFieldAttrRules:function(b){var c=e.rules,d={};return a.each(c,function(a,c){b.attr(c)&&(d[c]={error:b.attr(c+"-msg"),success:b.attr(c+"-success-msg")||"",propertyValue:b.attr(c)})}),d},getField:function(a){return this._storages[a]},register:function(a,b){return e.register(a,b),this},validate:function(){var b=this;b.fire("beforeValidate");var c,d=!0;return a.each(b._storages,function(a){var e=a.validate();return d=d&&e,c=a,b.AuthConfig.stopOnError&&!d?!1:void 0}),b.fire("validate",{result:d,lastField:c}),b.set("result",d),b.fire("afterValidate"),d}},{ATTRS:{result:{}}}),a.mix(i,{Field:d}),i},{requires:["json","base","./field/field","./rule/ruleFactory","./utils"]}),KISSY.add("gallery/auth/1.5/lib/index",function(a,b){return b},{requires:["./base"]}),KISSY.add("gallery/auth/1.5/index",function(a,b){return b},{requires:["./lib/index"]});